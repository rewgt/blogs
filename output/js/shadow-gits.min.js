// shadow-gits cdn ver 0.1.1
window.W||(window.W=new Array,W.$modules=[]),W.$modules.push(function(a,b,c){function l(a){return a?Array.isArray(a)?a:[a]:[]}function m(){return(new Date).toLocaleDateString().replace(/\//g,"-")}function n(a,b){return a.siteProtocol+"://"+a.siteDomain+("/"===b[0]?b:"/"+b)}function o(a,b,c){var d={type:"GET",dataType:"json",url:n(a,"/repos/"+b.user.login+"/"+b.repoName+"/contents/"+b.path),data:{_:(new Date).valueOf()+""},success:function(a,d,e){for(var f in a)b[f]=a[f];c&&c(null,b)},error:function(a,d){c&&c(new Error(d),b)}};a.siteAuth&&(d.headers={Authorization:a.siteAuth}),f.ajax(d)}function p(a,b,c,d,e,h,i,j){var k,l,o,p,q=m();if(i)k=i.path,k=k?k+"/"+b:b,l=i.branchName,o=i.repoName,p=i.user;else{if(!h)return;k=h.path,l=h.branchName,o=h.repoName,p=h.user}var r=void 0===c?j:g.encode(c);if(void 0!==r){var s={path:k,message:q,content:r,branch:l};d&&(s.sha=d);var t={type:"PUT",dataType:"json",url:n(a,"/repos/"+p.login+"/"+o+"/contents/"+k),data:s,success:function(d,f,g){var j=null,k=null;if(d.content&&"file"==d.content.type)if(j=new a.File(d.content,p,o,l),j.content=r,j.rawContent=c,i){var m=i.contents.findIndex(function(a){return a.name==b&&"file"==a.type});m>=0?i.contents.splice(m,1,j):i.contents.push(j)}else for(var n in j)j.hasOwnProperty(n)&&(h[n]=j[n]);d.commit&&a.Commit&&(k=new a.Commit(d.commit,p,o),j&&(j.sha&&(k.file_sha=j.sha),j.url&&(k.file_url=j.url))),e&&(j||(j=i?i.fileOf(b):h,j.content=r,j.rawContent=c),e(null,[j,k]))},error:function(a,b){e&&e(new Error(b),[null,null])}};a.siteAuth&&(t.headers={Authorization:a.siteAuth}),f.ajax(t)}}function q(a,b,c,d,e,g){var h,i,j,k,l=m();if(g)h=g.path,h=h?h+"/"+b:b,i=g.branchName,j=g.repoName,k=g.user;else{if(!e)return;h=e.path,i=e.branchName,j=e.repoName,k=e.user}var o={type:"DELETE",dataType:"json",url:n(a,"/repos/"+k.login+"/"+j+"/contents/"+h),data:{path:h,message:l,branch:i,sha:c},success:function(c,f,h){var i;if(g){var l=g.contents.findIndex(function(a){return a.name==b&&"file"==a.type});l>=0?(i=g.contents[l],g.contents.splice(l,1)):i=g.fileOf(b)}else i=e;if(d){var m=null;c.commit&&a.Commit&&(m=new a.Commit(c.commit,k,j)),d(null,[i,m])}},error:function(a,b){d&&d(new Error(b),[null,null])}};a.siteAuth&&(o.headers={Authorization:a.siteAuth}),f.ajax(o)}function r(a,b){"string"!=typeof a.content?a.fetchContent(function(c,d){c?b(c,d):b(null,a.content)}):b(null,a.content)}function s(a,b){"string"!=typeof a.content?a.fetchContent(function(c,d){c?b(c,d):(a.rawContent=g.decode(a.content),b(null,a.rawContent))}):("string"!=typeof a.rawContent&&(a.rawContent=g.decode(a.content)),b(null,a.rawContent))}function t(a,b,c){b.contents=[];var d={type:"GET",dataType:"json",url:n(a,"/repos/"+b.user.login+"/"+b.repoName+"/contents/"+b.path),data:{_:(new Date).valueOf()+"",ref:b.branchName},success:function(d,e,f){var g=b.contents;l(d).forEach(function(c){"file"==c.type&&g.push(new a.File(c,b.user,b.repoName,b.branchName)),"dir"==c.type&&g.push(new a.Dir(c,b.user,b.repoName,b.branchName))}),c&&c(null,b)},error:function(a,d){c&&c(new Error(d),b)}};a.siteAuth&&(d.headers={Authorization:a.siteAuth}),f.ajax(d)}function u(a,b,c,d,e,g){b.commits=[];var h={sha:b.branchName,_:(new Date).valueOf()+""};c&&(h.path=c),d&&(h.since=d),e&&(h.until=e);var i={type:"GET",dataType:"json",url:n(a,"/repos/"+b.user.login+"/"+b.repoName+"/commits"),data:h,success:function(c,d,e){var f=b.commits;l(c).forEach(function(c){if(c.commit){var d=new a.Commit(c.commit,b.user,b.repoName);c.sha&&(d.sha=c.sha),c.url&&(d.url=c.url),f.push(d)}}),g&&g(null,b)},error:function(a,c){g&&g(new Error(c),b)}};a.siteAuth&&(i.headers={Authorization:a.siteAuth}),f.ajax(i)}if(Array.prototype.findIndex||(Array.prototype.findIndex=function(a){if(null==this)throw new TypeError('"this" is null or not defined');var b=Object(this),c=b.length>>>0;if("function"!=typeof a)throw new TypeError("predicate must be a function");for(var d=arguments[1],e=0;e<c;){var f=b[e];if(a.call(d,f,e,b))return e;e++}return-1}),!Array.prototype.find){var d=Array.prototype.findIndex;Array.prototype.find=function(){if(null==this)throw new TypeError('"this" is null or not defined');var a=Object(this),b=d.apply(a,arguments);return b>=0?a[b]:void 0}}var e=a("shadow-widget"),f=e.$utils,g=f.Base64,h={},i={};f.gitOf=function(a,b){return a&&"string"==typeof a?0==a.indexOf("localhost")||0==a.indexOf("127.0.0.1")?(i.siteDomain=a,b&&(i.siteProtocol=b),i):(h.siteDomain=a,b&&(h.siteProtocol=b),h):h};var j=function(){};j.inherits=function(a,b,c){function f(a,b){for(var c in b)a[c]=b[c]}var d,e=function(){};return d=b&&b.hasOwnProperty("constructor")?b.constructor:function(){a.apply(this,arguments)},f(d,a),e.prototype=a.prototype,d.prototype=new e,b&&f(d.prototype,b),c&&f(d,c),d.prototype.constructor=d,d.__super__=a.prototype,d},j.extend=function(a,b){var c=j.inherits(this,a,b);return c.extend=this.extend,c};var k=j.extend({constructor:function(a,b,c,d){if(a)for(var e in a)this[e]=a[e];b&&(this.user=b),c&&(this.repoName=c),d&&(this.branchName=d)}},{});h.siteProtocol="https",h.siteDomain="api.github.com",h.siteAuth="",h.User=j.extend({constructor:function(a,b){if(b)for(var c in b)this[c]=b[c];if(!a)throw"invalid name";this.login=a,this.isLocal=!1},fetch:function(a){var b=this,c={type:"GET",dataType:"json",url:n(h,"/users/"+this.login),data:{_:(new Date).valueOf()+""},success:function(c,d,e){for(var f in c)b[f]=c[f];a&&a(null,b)},error:function(c,d){a&&a(new Error(d),b)}};h.siteAuth&&(c.headers={Authorization:h.siteAuth}),f.ajax(c)}},{}),h.Commit=j.extend({constructor:function(a,b,c){for(var d in a)this[d]=a[d];b&&(this.user=b),c&&(this.repoName=c)}},{}),h.File=k.extend({constructor:function(a,b,c,d){if(!c)throw"invalid repository";if(!d)throw"invalid branch";if(h.File.__super__.constructor.call(this,a,b,c,d),"string"!=typeof this.path)throw"invalid path";this.name||(this.name=this.path.split("/").pop())},fetchContent:function(a){o(h,this,a)},fetchCommits:function(a,b,c){u(h,this,this.path,b,c,a)},putContent:function(a,b,c){if(!this.sha)throw"no sha";p(h,this.name,a,this.sha,b,this,null,c)},remove:function(a){if(!this.sha)throw"no sha";q(this.name,this.sha,a,this,null)},readContent:function(a){r(this,a)},readRaw:function(a){s(this,a)}},{}),h.Dir=k.extend({constructor:function(a,b,c,d){if(!c)throw"invalid repository";if(!d)throw"invalid branch";if(this.contents=[],h.Dir.__super__.constructor.call(this,a,b,c,d),"string"!=typeof this.path)throw"invalid path"},fetchContents:function(a){t(h,this,a)},newFile:function(a,b,c,d){p(h,a,b,"",c,null,this,d)},putFile:function(a,b,c,d,e){if(!d){this.getFile(a)&&(d=file.sha)}if(!d)throw"invalid sha";p(h,a,b,d,c,null,this,e)},removeFile:function(a,b,c){if(!c){var d=this.getFile(a);if(!d)throw"unknown file";c=d.sha}if(!c)throw"invalid sha";q(a,c,b,null,this)},dirOf:function(a){var b=this.path;return b=b?b+"/"+a:a,new h.Dir({path:b},this.user,this.repoName,this.branchName)},fileOf:function(a){var b=this.path;return b=b?b+"/"+a:a,new h.File({path:b},this.user,this.repoName,this.branchName)},getFile:function(a){return this.contents.find(function(b){return b.name==a&&"file"==b.type})},getDir:function(a){return this.contents.find(function(b){return b.name==a&&"dir"==b.type})}},{}),h.Branch=j.extend({constructor:function(a,b,c){if(!b)throw"invalid repository";if(!c)throw"invalid branch";a&&(this.user=a),this.isLocal=!1,this.repoName=b,this.branchName=c,this.commits=[]},fetchCommits:function(a,b,c){u(h,this,"",b,c,a)},dirOf:function(a){return new h.Dir({path:a},this.user,this.repoName,this.branchName)},fileOf:function(a){return new h.File({path:a},this.user,this.repoName,this.branchName)}},{}),i.siteProtocol="http",i.siteDomain="localhost:3000",i.siteAuth="",i.User=j.extend({constructor:function(a,b){if(b)for(var c in b)this[c]=b[c];if(!a)throw"invalid name";this.login=a,this.isLocal=!0},fetch:function(a){a&&a(null,self)}},{}),i.Commit=null,i.File=k.extend({constructor:function(a,b,c,d){if(!c)throw"invalid repository";if(!d)throw"invalid branch";if(i.File.__super__.constructor.call(this,a,b,c,d),"string"!=typeof this.path)throw"invalid path";this.name||(this.name=this.path.split("/").pop())},fetchContent:function(a){o(i,this,a)},fetchCommits:function(a,b,c){a&&a(null,this)},putContent:function(a,b,c){p(i,this.name,a,"",b,this,null,c)},remove:function(a){q(i,this.name,"",a,this,null)},readContent:function(a){r(this,a)},readRaw:function(a){s(this,a)}},{}),i.Dir=k.extend({constructor:function(a,b,c,d){if(!c)throw"invalid repository";if(!d)throw"invalid branch";if(this.contents=[],i.Dir.__super__.constructor.call(this,a,b,c,d),"string"!=typeof this.path)throw"invalid path"},fetchContents:function(a){t(i,this,a)},newFile:function(a,b,c,d){p(i,a,b,"",c,null,this,d)},putFile:function(a,b,c,d){p(i,a,b,"",c,null,this,d)},removeFile:function(a,b){q(i,a,"",b,null,this)},dirOf:function(a){var b=this.path;return b=b?b+"/"+a:a,new i.Dir({path:b},this.user,this.repoName,this.branchName)},fileOf:function(a){var b=this.path;return b=b?b+"/"+a:a,new i.File({path:b},this.user,this.repoName,this.branchName)},getFile:function(a){return this.contents.find(function(b){return b.name==a&&"file"==b.type})},getDir:function(a){return this.contents.find(function(b){return b.name==a&&"dir"==b.type})}},{}),i.Branch=j.extend({constructor:function(a,b,c){if(!b)throw"invalid repository";if(!c)throw"invalid branch";a&&(this.user=a),this.isLocal=!0,this.repoName=b,this.branchName=c,this.commits=[]},fetchCommits:function(a,b,c){a&&a(null,this)},dirOf:function(a){return new i.Dir({path:a},this.user,this.repoName,this.branchName)},fileOf:function(a){return new i.File({path:a},this.user,this.repoName,this.branchName)}},{})});